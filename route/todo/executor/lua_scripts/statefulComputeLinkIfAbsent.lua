local function a(b,c)local d=string.find(b,c)if d then local e=string.sub(b,1,d-1)local f=string.sub(b,d+1,#b)return e,f end end;local g={}local h=ARGV[1]local i=redis.call("HGET",KEYS[1],h)if i then table.insert(g,i)return g else local j=tonumber(ARGV[2])local k=redis.call('HGETALL',KEYS[2])local l={}for m=1,#k,2 do local n=k[m]local o=k[m+1]local p,q=a(o,'-')local r=tonumber(q)if r>=j then l[n]=p end end;local s=nil;local t=nil;for u,v in pairs(l)do local w=tonumber(v)if not t or t>w then s=u;t=w end end;if not s then table.insert(g,'-1')return g else redis.call("HSET",KEYS[1],h,s)table.insert(g,s)return g end end
